{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, useEffect } from 'react';\nimport { gql } from 'apollo-boost';\nimport { useMutation } from '@apollo/react-hooks';\nimport { Text, Box, Heading, Modal, ModalOverlay, ModalContent, ModalHeader, ModalCloseButton, ModalBody, ModalFooter, useToast, Button } from '@chakra-ui/core';\nimport ReshipmentLineItem from './ReshipmentLineItem';\nimport { ORDER_QUERY, PAGINATION_QUERY } from '../pending/Pending';\nconst Layout = {\n  flex: '1 1 10rem',\n  marginLeft: '2rem',\n  marginTop: '2rem'\n};\nconst wideText = {\n  fontSize: 'xs',\n  fontWeight: 500,\n  color: 'gray.500',\n  letterSpacing: 'wide',\n  textTransform: 'uppercase'\n};\nconst CREATE_ORDER = gql`\n  mutation createOrder(\n    $shopName: String!\n    $orderId: Float!\n    $orderName: String!\n    $email: String\n    $first_name: String\n    $last_name: String\n    $streetAddress1: String!\n    $streetAddress2: String\n    $city: String!\n    $state: String!\n    $zip: String!\n    $lineItems: Json!\n    $currency: String!\n    $totalPrice: String!\n    $subTotalPrice: String!\n    $totalDiscount: String!\n    $totalTax: String!\n    $mpCart: String!\n    $zincCart: String!\n    $processed: Processed\n    $createAt: String!\n  ) {\n    createOrder(\n      shopName: $shopName\n      orderId: $orderId\n      orderName: $orderName\n      email: $email\n      first_name: $first_name\n      last_name: $last_name\n      streetAddress1: $streetAddress1\n      streetAddress2: $streetAddress2\n      city: $city\n      state: $state\n      zip: $zip\n      lineItems: $lineItems\n      currency: $currency\n      totalPrice: $totalPrice\n      totalDiscount: $totalDiscount\n      subTotalPrice: $subTotalPrice\n      totalTax: $totalTax\n      mpCart: $mpCart\n      zincCart: $zincCart\n      processed: $processed\n      createAt: $createAt\n    ) {\n      id\n      email\n    }\n  }\n`;\n\nfunction readFormField(data, field, onInput) {\n  return __jsx(Box, {\n    marginBottom: 2\n  }, __jsx(Text, {\n    contentEditable: \"true\",\n    onInput: onInput,\n    fontWeight: 500,\n    fontSize: \"md\",\n    color: \"text\"\n  }, data), __jsx(Heading, wideText, field));\n}\n\nconst Reshipment = ({\n  order,\n  shop,\n  isOpen,\n  onClose\n}) => {\n  const {\n    0: first,\n    1: setFirst\n  } = useState(null);\n  const {\n    0: last,\n    1: setLast\n  } = useState(null);\n  const {\n    0: address,\n    1: setAddress\n  } = useState(null);\n  const {\n    0: address2,\n    1: setAddress2\n  } = useState(null);\n  const {\n    0: city,\n    1: setCity\n  } = useState(null);\n  const {\n    0: state,\n    1: setState\n  } = useState(null);\n  const {\n    0: zip,\n    1: setZip\n  } = useState(null);\n  const {\n    0: lineItems,\n    1: setLineItems\n  } = useState(null);\n  const initialItems = [];\n  const toast = useToast();\n  const [createOrder, {\n    loading\n  }] = useMutation(CREATE_ORDER, {\n    refetchQueries: [{\n      query: ORDER_QUERY,\n      variables: {\n        skip: 0,\n        first: 100,\n        orderBy: 'createAt_ASC',\n        processed: 'FALSE'\n      }\n    }, {\n      query: PAGINATION_QUERY\n    }]\n  });\n  useEffect(() => {\n    if (order) {\n      setFirst(order.shippingAddress.name.split(' ')[0]);\n      setLast(order.shippingAddress.name.split(' ').pop());\n      setAddress(order.shippingAddress.address1);\n      setAddress2(order.shippingAddress.address2);\n      setCity(order.shippingAddress.city);\n      setState(order.shippingAddress.province);\n      setZip(order.shippingAddress.zip);\n      setLineItems(order.lineItems.edges);\n    }\n  }, [order]);\n\n  const handleLine = (ID, quantity, initialQty) => {\n    const temp = lineItems;\n    temp.map(item => {\n      if (item.node.id === ID) {\n        item.node.quantity = quantity;\n        const itemObj = {};\n        itemObj.id = ID;\n        itemObj.quantity = initialQty;\n        initialItems.push(itemObj);\n      }\n\n      return null;\n    });\n    setLineItems(temp);\n  };\n\n  const resetLineItems = () => {\n    const temp = lineItems;\n    initialItems.reverse();\n    temp.map(item => {\n      initialItems.forEach(function (initialItem) {\n        if (item.node.id === initialItem.id) {\n          item.node.quantity = initialItem.quantity;\n        }\n      });\n      return null;\n    });\n    setLineItems(temp);\n  };\n\n  return order ? __jsx(Modal, {\n    isOpen: isOpen,\n    onClose: onClose\n  }, __jsx(ModalOverlay, null), __jsx(ModalContent, null, __jsx(ModalHeader, null, \"Request Reshipment\"), __jsx(ModalCloseButton, null), __jsx(ModalBody, null, __jsx(Box, {\n    display: \"flex\",\n    flexWrap: \"wrap\",\n    marginLeft: \"-2rem\",\n    marginTop: \"-2rem\"\n  }, __jsx(Box, Layout, __jsx(Box, {\n    marginBottom: 4\n  }, __jsx(Text, {\n    fontWeight: 600,\n    fontSize: \"md\",\n    color: \"text\"\n  }, order.name), __jsx(Heading, wideText, \"Order Number\")), readFormField(order.shippingAddress.name.split(' ')[0], 'First Name', e => setFirst(e.target.textContent)), readFormField(order.shippingAddress.name.split(' ').pop(), 'Last Name', e => setLast(e.target.textContent)), readFormField(order.shippingAddress.address1, 'Street Address', e => setAddress(e.target.textContent)), order.shippingAddress.address2 && readFormField(order.shippingAddress.address2, 'Apt, Suite, etc.', e => setAddress2(e.target.textContent)), readFormField(order.shippingAddress.city, 'City', e => setCity(e.target.textContent)), readFormField(order.shippingAddress.province, 'State', e => setState(e.target.textContent)), readFormField(order.shippingAddress.zip, 'Zip Code', e => setZip(e.target.textContent))), __jsx(Box, Layout, order.lineItems.edges.map(a => __jsx(ReshipmentLineItem, {\n    arg: a.node,\n    handleLine: handleLine\n  }))))), __jsx(ModalFooter, null, __jsx(Button, {\n    variant: \"ghost\",\n    mr: 3,\n    onClick: onClose\n  }, \"Cancel\"), __jsx(Button, {\n    variant: \"ghost\",\n    variantColor: \"blue\",\n    bg: \"blue.50\",\n    _hover: {\n      bg: 'blue.100'\n    },\n    isLoading: loading,\n    onClick: async () => {\n      const res = await createOrder({\n        variables: {\n          shopName: `${shop}.myshopify.com`,\n          orderId: order.id.split('/').pop(),\n          orderName: order.name,\n          email: order.email || 'noemail@noemail.com',\n          first_name: first,\n          last_name: last,\n          streetAddress1: address,\n          streetAddress2: address2,\n          city,\n          state,\n          zip,\n          phone: order.shippingAddress.phone,\n          lineItems: lineItems.filter(a => a.node.quantity > 0).map(b => {\n            b.node.id = parseFloat(b.node.id.split('/').pop());\n            return b.node;\n          }),\n          currency: 'USD',\n          totalPrice: order.totalReceivedSet.shopMoney.amount,\n          subTotalPrice: 0,\n          totalDiscount: 0,\n          totalTax: 0,\n          createAt: order.processedAt,\n          mpCart: '{}',\n          zincCart: '{}',\n          processed: 'FALSE'\n        }\n      });\n      onClose();\n      toast({\n        position: 'top-right',\n        title: `${order.name} has been requested for reshipment.`,\n        status: 'success',\n        duration: 2000,\n        isClosable: true\n      });\n    }\n  }, \"Confirm Reshipment\")))) : __jsx(React.Fragment, null);\n};\n\nexport default Reshipment;","map":null,"metadata":{},"sourceType":"module"}